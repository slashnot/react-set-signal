{"version":3,"file":"reactSetSignal.js","sources":["../utils/createSignal.js","../hooks/useReactive.js","../hooks/useReactiveSignal.js"],"sourcesContent":["import { signal } from '@preact/signals-core'\r\nimport { create, isDraft, rawReturn } from 'mutative'\r\n\r\n// ------------------------------------\r\n// Immer style signal state producer\r\n// ------------------------------------\r\nexport const getSignalValue = ($signal, fnOrValue) => {\r\n    if (typeof fnOrValue === 'function') {\r\n        const mutationResponse = create($signal.value, (draft) => {\r\n            const result = fnOrValue(draft)\r\n\r\n            // fnOrValue is a funtion that used the draft\r\n            if (isDraft(result)) {\r\n                return draft\r\n            }\r\n            // fnOrValue is a funtion that returned an object, not used the draft\r\n            if (typeof result === 'object' && !isDraft(result)) {\r\n                return rawReturn(result)\r\n            }\r\n\r\n            return draft\r\n        })\r\n        // Return response when fnOrValues is a function\r\n        return mutationResponse\r\n    }\r\n    // Return value when fnOrValues is a value\r\n    return fnOrValue\r\n}\r\n\r\n\r\n// ------------------------------------\r\n// Immer style signal setter\r\n// ------------------------------------\r\nexport const setSignal = ($signal, fnOrValue) => {\r\n    $signal.value = getSignalValue($signal, fnOrValue)\r\n    return $signal.value\r\n}\r\n\r\n// ------------------------------------\r\n// Better Signal creator\r\n// ------------------------------------\r\nexport const createSignal = (initialValue) => {\r\n    const $signal = signal(initialValue)\r\n    $signal.set = (value) => setSignal($signal, value)\r\n    return $signal\r\n}\r\n// ------------------------------------\r\n","\r\nimport { useSyncExternalStore, useCallback, useMemo } from \"react\";\r\nimport { effect } from \"@preact/signals-core\";\r\nimport { createSignal } from \"../utils/createSignal\";\r\n\r\n/* *** ------------------------------------\r\n// useReactive takes an initial state\r\n// and returns a reactive state that updates\r\n// ---------------------------------------- */\r\nexport const useReactive = (initialState) => {\r\n    const $signal = useMemo(() => createSignal(initialState), []);\r\n    const snapshotFn = useCallback(() => $signal.value, [$signal]);\r\n    const serverSnapshotFn = () => $signal.peek();\r\n    // --- xx ----\r\n\r\n    const subscriptionFn = useCallback((listener) => {\r\n        return effect(() => {\r\n            listener($signal.value);\r\n        })\r\n    }, [$signal]);\r\n    // --- xx ----\r\n\r\n    const state = useSyncExternalStore(\r\n        subscriptionFn,\r\n        snapshotFn,\r\n        serverSnapshotFn\r\n    )\r\n    // --- xx ----\r\n\r\n    return [state, $signal.set]\r\n}\r\n","import { useSyncExternalStore, useCallback } from \"react\";\r\nimport { effect, Signal } from \"@preact/signals-core\";\r\n\r\n/* *** ------------------------------------\r\n// useReactiveSignal takes a Preact Signal\r\n// and returns a reactive state that updates\r\n// ---------------------------------------- */\r\nexport const useReactiveSignal = ($signal) => {\r\n    const snapshotFn = useCallback(() => $signal.value, [$signal]);\r\n    const serverSnapshotFn = () => $signal.peek();\r\n    // --- xx ----\r\n\r\n    const subscriptionFn = useCallback((listener) => {\r\n        return effect(() => {\r\n            listener($signal.value);\r\n        })\r\n    }, [$signal]);\r\n    // --- xx ----\r\n\r\n    const state = useSyncExternalStore(\r\n        subscriptionFn,\r\n        snapshotFn,\r\n        serverSnapshotFn\r\n    )\r\n    // --- xx ----\r\n\r\n    return state\r\n}"],"names":["getSignalValue","$signal","fnOrValue","create","draft","result","isDraft","rawReturn","setSignal","createSignal","initialValue","signal","value","useReactive","initialState","useMemo","snapshotFn","useCallback","serverSnapshotFn","subscriptionFn","listener","effect","useSyncExternalStore","useReactiveSignal"],"mappings":";;;;;AAMO,MAAMA,IAAiB,CAACC,GAASC,MAChC,OAAOA,KAAc,aACIC,EAAOF,EAAQ,OAAO,CAACG,MAAU;AACtD,QAAMC,IAASH,EAAUE,CAAK;AAG9B,SAAIE,EAAQD,CAAM,IACPD,IAGP,OAAOC,KAAW,YAAY,CAACC,EAAQD,CAAM,IACtCE,EAAUF,CAAM,IAGpBD;AACX,CAAC,IAKEF,GAOEM,IAAY,CAACP,GAASC,OAC/BD,EAAQ,QAAQD,EAAeC,GAASC,CAAS,GAC1CD,EAAQ,QAMNQ,IAAe,CAACC,MAAiB;AAC1C,QAAMT,IAAUU,EAAOD,CAAY;AACnC,SAAAT,EAAQ,MAAM,CAACW,MAAUJ,EAAUP,GAASW,CAAK,GAC1CX;AACX,GCpCaY,IAAc,CAACC,MAAiB;AACzC,QAAMb,IAAUc,EAAQ,MAAMN,EAAaK,CAAY,GAAG,CAAA,CAAE,GACtDE,IAAaC,EAAY,MAAMhB,EAAQ,OAAO,CAACA,CAAO,CAAC,GACvDiB,IAAmB,MAAMjB,EAAQ,QAGjCkB,IAAiBF,EAAY,CAACG,MACzBC,EAAO,MAAM;AAChB,IAAAD,EAASnB,EAAQ,KAAK;AAAA,EAC1B,CAAC,GACF,CAACA,CAAO,CAAC;AAUZ,SAAO,CAPOqB;AAAA,IACVH;AAAA,IACAH;AAAA,IACAE;AAAA,EACR,GAGmBjB,EAAQ,GAAG;AAC9B,GCvBasB,IAAoB,CAACtB,MAAY;AAC1C,QAAMe,IAAaC,EAAY,MAAMhB,EAAQ,OAAO,CAACA,CAAO,CAAC,GACvDiB,IAAmB,MAAMjB,EAAQ,QAGjCkB,IAAiBF,EAAY,CAACG,MACzBC,EAAO,MAAM;AAChB,IAAAD,EAASnB,EAAQ,KAAK;AAAA,EAC1B,CAAC,GACF,CAACA,CAAO,CAAC;AAUZ,SAPcqB;AAAA,IACVH;AAAA,IACAH;AAAA,IACAE;AAAA,EACR;AAIA;"}